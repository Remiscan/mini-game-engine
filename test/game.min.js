import*as GEM from"../game-engine.js";const cellSize=64,canvas=document.querySelector("canvas");canvas.width=window.innerWidth,canvas.height=window.innerHeight;class Star{constructor(t,e){const i=Math.round(2*Math.random());this.size=i,this.type=0==i?"blue":1==i?"yellow":"red",this.position={x:64*e,y:64*t,z:1};this.decalage={x:12+Math.round(40*Math.random()),y:12+Math.round(40*Math.random())}}get params(){return{width:64,height:64,position:this.position,draw:function(t){t.imageSmoothingEnabled=!0,t.beginPath(),t.arc(this.position.x+this.state.decalage.x,this.position.y+this.state.decalage.y,8+2*this.state.size,0,2*Math.PI),t.fillStyle=0===this.state.size?"#FFCF6E":1===this.state.size?"#FFFFCF":"#D7E0FF",t.fillStyle+="55",t.fill()}}}}const start=async function(){this.state.jumpFrames=0,this.addActions({jump:["Space"]});const t=this.addLevel({id:"test0",width:64*Math.floor(window.innerWidth/64),height:64*Math.floor(window.innerHeight/64)});t.addObject({width:t.width,height:t.height,draw:function(t){t.fillStyle="black",t.fillRect(0,0,this.width,this.height)}}),t.addObject({id:"rect",width:32,height:32,position:{x:64,y:64},collision:!0,draw:function(t){this.allCollisions().length>0?t.fillStyle="red":t.fillStyle="blue",t.fillRect(this.position.x,this.position.y,this.width,this.height)}}),this.addImage("boole","assets/boole1.png"),this.addSound("bump","assets/ouch.mp3"),t.addObject({id:"player",width:32,height:32,position:{x:32,y:128},maxSpeed:5,controllable:!0,collision:!0,assets:["boole","bump"],draw:function(t,{x:e,y:i,game:a}){const s=this.assets.find((t=>"boole"===t.id)).data;t.imageSmoothingEnabled=!1,this.state.facingRight?(t.translate(a.width,0),t.scale(-1,1),t.drawImage(s,a.width-e,i,-this.width,this.height)):t.drawImage(s,e,i,this.width,this.height)}});for(let e=0;e<Math.floor(window.innerHeight/64)/3;e++)for(let i=0;i<Math.floor(window.innerWidth/64)/3;i++){const a=new Star(3*e+Math.round(2*Math.random()),3*i+Math.round(2*Math.random())),s=t.addObject(a.params);s.state.decalage=a.decalage,s.state.size=a.size}await this.loadLevel("test0")},update=function(t){this.state.actions.includes("jump")?this.state.jumpFrames++:this.state.jumpFrames>0&&(this.state.jumpFrames=0);const e=[...this.state.level.objects].filter((t=>t.controllable));for(const i of e){const e=Object.assign({},i.position),a={x:(-this.state.actions.includes("left")+this.state.actions.includes("right"))*t,y:(-this.state.actions.includes("up")+this.state.actions.includes("down"))*t};if(a.x>0?i.state.facingRight=!0:a.x<0&&(i.state.facingRight=!1),0===a.x&&0===a.y){i.state.bumped=!1;continue}const s=i.moveByVector(a);s.x===e.x&&s.y===e.y&&(i.state.bumped||this.playSound("bump"),i.state.bumped=!0)}},game=new GEM.Game(start,update,{tickRate:60}),buttonPlay=document.querySelector(".load-game");buttonPlay.addEventListener("click",(()=>{buttonPlay.remove(),game.play()}));const buttonPause=document.querySelector(".pause-game");buttonPause.addEventListener("click",(()=>game.paused=!game.paused));